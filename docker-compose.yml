version: '3.3'
services:
   postgres:
      container_name: postgres
      image: postgres:14.0-alpine
      restart: unless-stopped
      env_file:
         - /var/lib/hydrominder/var/db.env
   api:
      container_name: api
      image: registry.gitlab.utwente.nl/cs21-32/hydrominder_api
      restart: unless-stopped
      env_file:
         - /var/lib/hydrominder/var/db.env
         - /var/lib/hydrominder/var/api.env
         - /var/lib/hydrominder/var/api_cookie.env
         - /var/lib/hydrominder/var/controller_token.env
      volumes:
         - /var/lib/hydrominder/shutdown_signal:/shutdown_signal
      depends_on:
         - postgres
   webapp:
      container_name: webapp
      image: registry.gitlab.utwente.nl/cs21-32/hydrominder_app
      restart: unless-stopped
      ports:
         - 80:80
         - 443:443
      depends_on:
         - api
      volumes:
         - ./nginx.conf:/etc/nginx/nginx.conf:ro
         - /var/lib/hydrominder/ssl/hydrominder.crt:/etc/ssl/certs/hydrominder-selfsigned.crt:ro
         - /var/lib/hydrominder/ssl/hydrominder.key:/etc/ssl/private/hydrominder-selfsigned.key:ro
